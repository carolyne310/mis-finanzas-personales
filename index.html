<!DOCTYPE html>
<html lang="es">
<head>
  <!-- SEO BSICO -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Aura - Finanzas personales modernas, simples y seguras." />
  <title>Aura 路 Finanzas Personales</title>

  <!-- FUENTE -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- TAILWIND CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            jakarta: ['"Plus Jakarta Sans"', 'sans-serif']
          },
          borderRadius: {
            xl2: '2.5rem'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-slate-50 font-jakarta text-slate-900">
  <div id="root"></div>

  <!-- REACT -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- ICONOS -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const { useState, useEffect } = React;

    /* ================= FIREBASE CONFIG ================= */
    const firebaseConfig = {
      apiKey: "AIzaSyD2h9l8LDl_R85R6R5Lr961jcoxVCDkSNs",
  authDomain: "mis-finanzas-600dc.firebaseapp.com",
  projectId: "mis-finanzas-600dc",
  storageBucket: "mis-finanzas-600dc.firebasestorage.app",
  messagingSenderId: "509918317471",
  appId: "1:509918317471:web:b7e6c9bfc1892fcf5d4baa"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const APP_ID = "aura";

    /* ================= UTILIDADES ================= */
    const exportToCSV = (transactions) => {
      const headers = ["Monto", "Tipo", "Categor铆a", "Nota", "Fecha"];
      const rows = transactions.map(t =>
        [t.amount, t.type, t.category, t.note, new Date(t.createdAt).toLocaleString()]
      );
      let csvContent = "data:text/csv;charset=utf-8,"
        + headers.join(",") + "\n"
        + rows.map(e => e.join(",")).join("\n");

      const link = document.createElement("a");
      link.href = encodeURI(csvContent);
      link.download = "aura-transacciones.csv";
      link.click();
    };

    /* ================= COMPONENTE AUTH ================= */
    function AuthScreen({ onAuth }) {
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [error, setError] = useState("");

      const handleSubmit = async () => {
        setError("");
        try {
          if (isLogin) {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
        } catch (err) {
          setError(err.message);
        }
      };

      const loginWithGoogle = async () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
      };

      return (
        <div class="min-h-screen flex items-center justify-center px-6">
          <div class="bg-white p-8 rounded-xl2 shadow-xl w-full max-w-sm">
            <h1 class="text-3xl font-bold text-indigo-700 text-center mb-2">Aura</h1>
            <p class="text-center text-slate-500 mb-6">
              Finanzas personales, sin estr茅s
            </p>

            <input
              class="w-full mb-3 p-3 rounded-xl border"
              placeholder="Correo electr贸nico"
              onInput={e => setEmail(e.target.value)}
            />
            <input
              type="password"
              class="w-full mb-3 p-3 rounded-xl border"
              placeholder="Contrase帽a"
              onInput={e => setPassword(e.target.value)}
            />

            {error && <p class="text-red-500 text-sm mb-2">{error}</p>}

            <button
              class="w-full bg-indigo-700 text-white py-3 rounded-xl mb-3"
              onClick={handleSubmit}
            >
              {isLogin ? "Iniciar Sesi贸n" : "Registrarse"}
            </button>

            <button
              class="w-full border py-3 rounded-xl mb-3"
              onClick={loginWithGoogle}
            >
              Ingresar con Google
            </button>

            <p class="text-center text-sm text-slate-500">
              {isLogin ? "驴No tienes cuenta?" : "驴Ya tienes cuenta?"}
              <span
                class="text-indigo-700 ml-1 cursor-pointer"
                onClick={() => setIsLogin(!isLogin)}
              >
                {isLogin ? "Reg铆strate" : "Inicia sesi贸n"}
              </span>
            </p>
          </div>
        </div>
      );
    }

    /* ================= DASHBOARD ================= */
    function App() {
      const [user, setUser] = useState(null);
      const [transactions, setTransactions] = useState([]);
      const [tab, setTab] = useState("home");

      useEffect(() => {
        auth.onAuthStateChanged(u => setUser(u));
      }, []);

      useEffect(() => {
        if (!user) return;
        return db
          .collection("artifacts")
          .doc(APP_ID)
          .collection("users")
          .doc(user.uid)
          .collection("transactions")
          .orderBy("createdAt", "desc")
          .onSnapshot(snap => {
            setTransactions(snap.docs.map(d => ({ id: d.id, ...d.data() })));
          });
      }, [user]);

      if (!user) return <AuthScreen />;

      const balance = transactions.reduce((acc, t) => {
        if (t.type === "ingreso") return acc + t.amount;
        if (t.type === "gasto") return acc - t.amount;
        return acc;
      }, 0);

      return (
        <div class="pb-28">
          {/* HEADER */}
          <div class="bg-indigo-700 text-white rounded-b-xl2 p-6">
            <p class="text-sm opacity-80">Balance Total</p>
            <h2 class="text-3xl font-bold">S/ {balance.toFixed(2)}</h2>
          </div>

          {/* CONTENIDO */}
          <div class="p-4">
            <button
              class="mb-4 bg-emerald-500 text-white px-4 py-2 rounded-xl"
              onClick={() => exportToCSV(transactions)}
            >
              Exportar CSV
            </button>

            {transactions.map(t => (
              <div
                key={t.id}
                class="bg-white p-4 mb-3 rounded-xl shadow flex justify-between"
              >
                <div>
                  <p class="font-semibold">
                    {t.type === "ingreso" ? "" : ""} {t.category}
                  </p>
                  <p class="text-sm text-slate-500">{t.note}</p>
                </div>
                <p class={
                  t.type === "ingreso"
                    ? "text-emerald-600"
                    : "text-rose-500"
                }>
                  S/ {t.amount}
                </p>
              </div>
            ))}
          </div>

          {/* NAV BAR */}
          <div class="fixed bottom-4 left-4 right-4 bg-white/70 backdrop-blur-xl rounded-xl2 shadow-lg flex justify-around py-3">
            <button onClick={() => setTab("home")}></button>
            <button></button>
            <button></button>
            <button onClick={() => auth.signOut()}></button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
